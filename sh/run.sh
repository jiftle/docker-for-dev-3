#!/bin/bash
# -----------------------------------------------------------------
# FileName: run.sh
# Date: 2020-01-09
# Author: jiftle
# Description: 
# -----------------------------------------------------------------
# set -e
cd ..
# å¼•ç”¨è„šæœ¬
. ./conf.conf

# --------------- å®šä¹‰å˜é‡ ------------------
GitPath="${HOME}/tg-git"
echo "------------- è¿è¡Œ[${DockerKey}:${DockerVer}]é•œåƒçš„å®¹å™¨ ------------"

echo "  |--> åˆ é™¤Dockerå®ä¾‹ï¼Œ[${ContainerName}] ..."
docker rm -f ${ContainerName}

echo "  |--> å¼€å§‹å¯åŠ¨Dockerå®ä¾‹ï¼Œ[${ContainerName}] ..."

# docker run -itd \
# `# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- è®¾ç½®åç§° -------------` \
# --name="${ContainerName}" \
# `# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- å·¥ä½œç›®å½•æ˜ å°„ -------------` \
# -w /home/john `# é»˜è®¤å·¥ä½œç›®å½•` \
# -v ${HOME}:/home/john `# é»˜è®¤å·¥ä½œç›®å½•ï¼Œæ˜ å°„` \
# -v ${GitPath}:/home/john/git `# gitä»“åº“ç›®å½•` \
# `# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- ç”¨æˆ·å¯†é’¥ -------------` \
# -v ${HOME}/.ssh:/root/.ssh `# .sshå¯†é’¥` \
# `# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- ç«¯å£æ˜ å°„ -------------` \
# `# -p 8001:8001 # æ—¥å¿—ä»“åº“ï¼Œé¢„è§ˆæœåŠ¡` \
# `# -p 8080:8080 # webç¨‹åºè°ƒè¯•ç«¯å£` \
# `# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- è§£å†³æ—¶åŒºé—®é¢˜ -------------` \
# -h "${ContainerName}" `# æœºå™¨å` \
# --restart=always `# è‡ªå¯åŠ¨ï¼Œå®¹æ˜“å¯¼è‡´æŒ‚è½½çš„åˆ†åŒºï¼Œæ™šäºdocker` \
# `# é•œåƒå` \
# ${DockerKey}:${DockerVer}

# docker run -itd \
# `# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- è®¾ç½®åç§° -------------` \
# --name="${ContainerName}" \
# `# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- å·¥ä½œç›®å½•æ˜ å°„ -------------` \
# -w /home/john `# é»˜è®¤å·¥ä½œç›®å½•` \
# -v ${GitPath}:/home/john/git `# gitä»“åº“ç›®å½•` \
# `# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- ç”¨æˆ·å¯†é’¥ -------------` \
# -v ${HOME}/.ssh:/root/.ssh `# .sshå¯†é’¥` \
# `# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- ç«¯å£æ˜ å°„ -------------` \
# `# -p 8001:8001 # æ—¥å¿—ä»“åº“ï¼Œé¢„è§ˆæœåŠ¡` \
# `# -p 8080:8080 # webç¨‹åºè°ƒè¯•ç«¯å£` \
# `# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- è§£å†³æ—¶åŒºé—®é¢˜ -------------` \
# -h "${ContainerName}" `# æœºå™¨å` \
# --restart=always `# è‡ªå¯åŠ¨ï¼Œå®¹æ˜“å¯¼è‡´æŒ‚è½½çš„åˆ†åŒºï¼Œæ™šäºdocker` \
# `# é•œåƒå` \
# ${DockerKey}:${DockerVer}
# echo "  |--> å¯åŠ¨Docker[${ContainerName}]å®Œæ¯•. ^_^ğŸ˜"

# --------------- å®šä¹‰å˜é‡ ------------------
GitPath="/usrlocal/git"
MavenPath="/usrlocal/maven"

echo "================= [${DockerName}(${DockerKey}:${DockerVer}] ===================="
echo "---> è®¾ç½®x11è®¿é—®æ§åˆ¶"
xhost +

echo "  |--> [${DockerName}(${DockerKey}:${DockerVer}] å¼€å§‹å¯åŠ¨..."

# ----------- è¿è¡Œå®¹å™¨ ------------
docker run -itd \
`# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- è®¾ç½®å®¹å™¨å®ä¾‹åç§° -------------` \
--name="${ContainerName}" \
`# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- å·¥ä½œç›®å½•æ˜ å°„ -------------` \
-w /root `# é»˜è®¤å·¥ä½œç›®å½•` \
-v ${HOME}:/home/john `# é»˜è®¤å·¥ä½œç›®å½•ï¼Œæ˜ å°„` \
-v ${GitPath}:/home/john/git `# gitä»“åº“ç›®å½•` \
-v ${MavenPath}:/home/john/maven `# mavenä»“åº“ç›®å½•` \
`# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- ç”¨æˆ·å¯†é’¥ -------------` \
-v ${HOME}/.ssh:/root/.ssh `# .sshå¯†é’¥,éœ€è¦å…·æœ‰å†™æƒé™` \
`# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- ç«¯å£æ˜ å°„ -------------` \
`# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- è§£å†³æ—¶åŒºé—®é¢˜ -------------` \
-v /etc/localtime:/etc/localtime:ro \
-h "${ContainerName}" `# æœºå™¨å` \
`# --cpuset-cpus="0" # æŒ‡å®šä½¿ç”¨CPUçš„ç¼–å·` \
`# -m 2G # é™åˆ¶æœ€å¤§å†…å­˜å ç”¨` \
--privileged \
`# --memory-swap=4G # äº¤æ¢å†…å­˜` \
--restart=always `# è‡ªå¯åŠ¨ï¼Œå®¹æ˜“å¯¼è‡´æŒ‚è½½çš„åˆ†åŒºï¼Œæ™šäºdockerï¼Œä½¿ç”¨æ—¶åšå¥½ç£ç›˜æŒ‚è½½ï¼Œå»ºè®®ä¿®æ”¹/etc/fstab` \
`# -------------- GUIç¨‹åºè®¾ç½® ----------------` \
-v /tmp/.X11-unix:/tmp/.X11-unix \
-e DISPLAY=unix$DISPLAY \
--cap-add=SYS_PTRACE --security-opt seccomp=unconfined `# è§£å†³dlvè°ƒè¯•é™„åŠ å¤±è´¥çš„é—®é¢˜` \
`# é•œåƒå` \
${DockerKey}:${DockerVer} \
bash
echo "  |--> [${DockerName}(${DockerKey}:${DockerVer}] å¯åŠ¨æˆåŠŸ. ^-^"

# # ----------- è¿è¡Œå®¹å™¨ ------------
# docker run -it \
# `# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- è®¾ç½®å®¹å™¨å®ä¾‹åç§° -------------` \
# --name="${ContainerName}" \
# `# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- å·¥ä½œç›®å½•æ˜ å°„ -------------` \
# -w /root `# é»˜è®¤å·¥ä½œç›®å½•` \
# -v ${HOME}:/home/john `# é»˜è®¤å·¥ä½œç›®å½•ï¼Œæ˜ å°„` \
# -v ${GitPath}:/home/john/git `# gitä»“åº“ç›®å½•` \
# -v ${MavenPath}:/home/john/maven `# mavenä»“åº“ç›®å½•` \
# `# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- ç”¨æˆ·å¯†é’¥ -------------` \
# -v ${HOME}/.ssh:/root/.ssh `# .sshå¯†é’¥,éœ€è¦å…·æœ‰å†™æƒé™` \
# `# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- ç«¯å£æ˜ å°„ -------------` \
# -p 8001:8001 `# æ—¥å¿—ä»“åº“ï¼Œé¢„è§ˆæœåŠ¡` \
# -p 8080:8080 `# webç¨‹åºè°ƒè¯•ç«¯å£` \
# `# æ³¨é‡Šè¯·å¿½ç•¥ï¼Œ----------- è§£å†³æ—¶åŒºé—®é¢˜ -------------` \
# -v /etc/localtime:/etc/localtime:ro \
# -h "${ContainerName}" `# æœºå™¨å` \
# `# --cpuset-cpus="0" # æŒ‡å®šä½¿ç”¨CPUçš„ç¼–å·` \
# `# -m 2G # é™åˆ¶æœ€å¤§å†…å­˜å ç”¨` \
# --privileged \
# `# --memory-swap=4G # äº¤æ¢å†…å­˜` \
# --restart=always `# è‡ªå¯åŠ¨ï¼Œå®¹æ˜“å¯¼è‡´æŒ‚è½½çš„åˆ†åŒºï¼Œæ™šäºdockerï¼Œä½¿ç”¨æ—¶åšå¥½ç£ç›˜æŒ‚è½½ï¼Œå»ºè®®ä¿®æ”¹/etc/fstab` \
# `# -------------- GUIç¨‹åºè®¾ç½® ----------------` \
# -v /tmp/.X11-unix:/tmp/.X11-unix \
# -e DISPLAY=unix$DISPLAY \
# --cap-add=SYS_PTRACE --security-opt seccomp=unconfined `# è§£å†³dlvè°ƒè¯•é™„åŠ å¤±è´¥çš„é—®é¢˜` \
# `# é•œåƒå` \
# ${DockerKey}:${DockerVer} \
# /sbin/init
# echo "  |--> [${DockerName}(${DockerKey}:${DockerVer}] å¯åŠ¨æˆåŠŸ. ^-^"
